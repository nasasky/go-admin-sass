[0;34m[INFO][0m 开始调试推送系统...
[0;34m[INFO][0m === 检查数据库中的管理员用户 ===
[0;34m[INFO][0m 检查user表结构...
[1;33m[WARNING][0m 未找到notice或user_type字段
[0;34m[INFO][0m 检查管理员用户数量...
[0;34m[INFO][0m === 检查Redis中的离线消息 ===
[1;33m[WARNING][0m 未找到离线消息
[0;34m[INFO][0m === 检查MongoDB中的接收记录 ===
[1;33m[WARNING][0m mongo客户端未安装，跳过MongoDB检查
[0;34m[INFO][0m === 检查WebSocket连接状态 ===
[0;31m[ERROR][0m WebSocket端点异常
[0;34m[INFO][0m WebSocket统计: <html><head><meta http-equiv='refresh' content='1;url=/login?from=%2Fapi%2Fadmin%2Fws%2Fstats'/><script id='redirect' data-redirect-url='/login?from=%2Fapi%2Fadmin%2Fws%2Fstats' src='/static/17a1364a/scripts/redirect.js'></script></head><body style='background-color:white; color:white;'>
Authentication required
<!--
-->

</body></html>                                                                                                                                                                                                                                                                                                            
[0;34m[INFO][0m === 检查代码逻辑 ===
[0;31m[ERROR][0m getAdminUserIDs可能使用错误的字段
[0;32m[SUCCESS][0m createAdminUserReceiveRecords方法存在
[0;32m[SUCCESS][0m 离线消息保存逻辑存在
[0;32m[SUCCESS][0m 用户连接注册逻辑存在
[0;34m[INFO][0m === 测试推送功能 ===
[1;33m[WARNING][0m 需要有效的管理员token才能测试推送功能
[0;34m[INFO][0m 建议手动测试以下步骤:
[0;34m[INFO][0m 1. 登录管理端获取token
[0;34m[INFO][0m 2. 发送测试消息: POST http://localhost:8080/api/admin/system/notice
[0;34m[INFO][0m 3. 检查接收记录: GET http://localhost:8080/api/admin/notification/admin-receive-records
[0;34m[INFO][0m 4. 检查在线用户: GET http://localhost:8080/api/admin/notification/online-users
[0;34m[INFO][0m === 问题诊断报告 ===
## 可能的问题原因:
1. 管理员用户筛选条件错误
   - getAdminUserIDs可能使用了错误的字段
   - 数据库中没有符合条件的管理员用户

2. 用户在线状态检测问题
   - RegisterUserConnection可能没有被正确调用
   - MongoDB中的在线状态记录可能不准确

3. 离线消息保存问题
   - 用户不在线时消息可能没有保存到Redis
   - 离线消息发送时可能没有更新接收状态

4. 接收记录创建问题
   - createAdminUserReceiveRecords可能没有被调用
   - 接收记录保存时可能有错误

## 建议的修复步骤:
1. 确认数据库中有管理员用户
2. 检查getAdminUserIDs的筛选条件
3. 验证用户连接注册逻辑
4. 测试离线消息保存和发送
5. 检查接收记录的创建和更新
[0;32m[SUCCESS][0m 调试完成！详细报告已保存到 push_system_debug.log
